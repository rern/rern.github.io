<!DOCTYPE html>
<html>
<head>

<title>Wi-Fi Profile</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="rAudio">
<meta name="application-name" content="rAudio">
<meta name="msapplication-tap-highlight" content="no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icon.png">
<link rel="icon" href="assets/img/icon.png">
<link rel="stylesheet" href="assets/css/colors.css?v=1705954403">
<link rel="stylesheet" href="assets/css/common.css?v=1705954403">
<link rel="stylesheet" href="assets/css/settings.css?v=1705954403">
<style>
#infoX { display: none }
</style>

</head>
<body>
<div id="infoOverlay" class="hide" tabindex="-1"></div>

<div class="head" style="z-index: 120">
	<i class="page-icon i-raudio"></i><span class='title'>Wi-Fi Profile Generator</span>
</div>

<script src="assets/js/plugin/jquery-3.7.1.min.js"></script>
<script src="assets/js/common.js?v=1705954403"></script>
<script>
var V         = {}
var default_v = {
	  dhcp   : { SSID: '', PASSPHRASE: '', HIDDEN: false }
	, static : { SSID: '', PASSPHRASE: '', ADDRESS: '', GATEWAY: '', HIDDEN: false }
}
var list      = [
	  [ 'SSID',        'text' ]
	, [ 'Password',    'password' ]
	, [ 'IP',          'text' ]
	, [ 'Gateway',     'text' ]
	, [ 'Hidden SSID', 'checkbox' ]
];
var icon      = 'wifi';
var title     = 'Wi-Fi Profile';
function infoWiFi() {
	var listdhcp  = list.slice( 0 );
	listdhcp.splice( 2, 2 );
	info( {
		  icon       : icon
		, title      : title
		, tablabel   : [ 'DHCP', 'Static IP' ]
		, tab        : [ '', () => infoWiFiTab( infoVal() ) ]
		, boxwidth   : 180
		, list       : listdhcp
		, values       : default_v.dhcp
		, checkblank : [ 0 ]
		, ok         : () => profile( infoVal() )
	} );
}
function infoWiFiStatic() {
	info( {
		  icon       : icon
		, title      : title
		, tablabel   : [ 'DHCP', 'Static IP' ]
		, tab        : [ () => infoWiFiTab( infoVal() ), '' ]
		, boxwidth   : 180
		, list       : list
		, values     : default_v.static
		, checkblank : [ 0 ]
		, checkip    : [ 2, 3 ]
		, ok         : () => profile( infoVal() )
	} );
}
function infoWiFiTab( values ) {
	var target = 'ADDRESS' in values ? 'dhcp' : 'static';
	var keys   = Object.keys( default_v[ target ] );
	var v      = {}
	keys.forEach( k => v[ k ] = values[ k ] );
	target === 'dhcp' ? infoWiFi( v ) : infoWiFiStatic( v );
}
function profile( val ) {
	var data = 'SSID="'+ val.SSID +'"\n';
	if ( val.PASSPHRASE ) data += '\n[Security]'
								 +'\nPassphrase="'+ val.PASSPHRASE +'"\n';
	if ( val.HIDDEN )     data += '\n[Settings]'
								 +'\nHidden=true\n';
	if ( val.GATEWAY )    data += '\n[IPv4]'
								 +'\nAddress='+ val.ADDRESS
								 +'\nGateway='+ val.GATEWAY;
	var blob = new Blob( [ data ], { type: 'application/text;charset=utf-8' } );
	var a    = document.createElement( 'a' );
	a.setAttribute( 'download', 'wifi' );
	a.setAttribute( 'href', window.URL.createObjectURL( blob ) );
	a.click();
	info( {
		  icon    : icon
		, title   : title
		, message : 'File <c>wifi</c> has been downloaded.'
					+'<br><br>Copy it to folder <c>/boot</c> on SD card.'
		, okno    : true
	} );

}
function refreshData() {
	return
}

infoWiFi();
</script>

</body>
</html>
