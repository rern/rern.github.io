# Maintainer: Filip Matzner <filip.matzner@iterait.com>

pkgname=mediamtx
pkgver=0.23.5
pkgrel=2
pkgdesc="Ready-to-use and zero-dependency RTSP / RTMP / HLS server and proxy."
arch=('armv7h' 'aarch64')
url="https://github.com/bluenviron/mediamtx"
license=('MIT')
provides=("$pkgname")
conflicts=("$pkgname")
source=("$pkgname.service")
source_armv7h=("$url/releases/download/v$pkgver/${pkgname}_v${pkgver}_linux_armv7.tar.gz")
source_aarch64=("$url/releases/download/v$pkgver/${pkgname}_v${pkgver}_linux_arm64v8.tar.gz")
sha256sums=('SKIP')
sha256sums_armv7h=('SKIP')
sha256sums_aarch64=('SKIP')

package() {
    install -Dm644 "$pkgname.service" "${pkgdir}/usr/lib/systemd/system/$pkgname.service"
    cd "$srcdir/$pkgname-$pkgver"
    install -Dm755 "build/$pkgname" "${pkgdir}/usr/bin/$pkgname"
    install -Dm644 "$pkgname.yml" "$pkgdir/etc/$pkgname/$pkgname.yml"
}

package() {
	cd "$srcdir"

	install -dm755 "$pkgdir/etc/$pkgname"

	install -Dm755 "$srcdir/$pkgname" "$pkgdir/usr/bin/$pkgname"
	install -Dm600 "$srcdir/$pkgname.yml" "$pkgdir/etc/$pkgname/$pkgname.yml"
	install -Dm644 "$srcdir/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

	install -Dm644 "$srcdir/$pkgname.service" "$pkgdir/usr/lib/systemd/system/$pkgname.service"
}

